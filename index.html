<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>단어 시험</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#12141c;
      --text:#e7e9ee;
      --muted:#9aa3b2;
      --line:#262b36;
      --accent:#7aa7ff;
      --good:#3ddc97;
      --bad:#ff6b6b;
      --btn:#1b2130;
      --btn2:#20283a;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple SD Gothic Neo","Noto Sans KR", sans-serif;
      background: radial-gradient(1200px 600px at 30% -10%, #16204a, transparent 55%),
                  radial-gradient(900px 700px at 90% 0%, #2a1638, transparent 60%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    .wrap{
      max-width: 920px;
      margin: 0 auto;
      padding: 18px 14px 70px;
    }
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      margin-bottom:14px;
    }
    .title{
      font-weight:800;
      letter-spacing:-0.2px;
      font-size: 18px;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border:1px solid var(--line);
      background: rgba(18,20,28,.75);
      border-radius: 999px;
      color: var(--muted);
      font-size: 12px;
      white-space:nowrap;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:12px;
    }
    @media (min-width: 860px){
      .grid{grid-template-columns: 360px 1fr;}
    }
    .card{
      border:1px solid var(--line);
      background: rgba(18,20,28,.78);
      border-radius: 14px;
      padding: 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .card h2{
      margin:0 0 10px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: .2px;
      text-transform: uppercase;
    }
    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin: 10px 0 6px;
    }
    input, select{
      width:100%;
      padding: 10px 10px;
      border-radius: 10px;
      border: 1px solid var(--line);
      background: rgba(10,12,16,.6);
      color: var(--text);
      outline:none;
    }
    input:focus, select:focus{border-color: rgba(122,167,255,.6); box-shadow: 0 0 0 3px rgba(122,167,255,.15)}
    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .btns{display:flex; gap:10px; margin-top:12px;}
    button{
      border:1px solid var(--line);
      background: linear-gradient(180deg, rgba(27,33,48,.95), rgba(20,24,35,.95));
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      cursor:pointer;
      font-weight: 750;
      letter-spacing:-.1px;
      flex:1;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover{border-color: rgba(122,167,255,.35)}
    button:active{transform: translateY(1px)}
    button.secondary{
      background: rgba(16,18,25,.5);
      color: var(--muted);
      font-weight:700;
    }
    button:disabled{opacity:.5; cursor:not-allowed; transform:none}
    .muted{color:var(--muted)}
    .sep{height:1px; background:var(--line); margin: 12px 0;}
    .scoreline{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .scoreline .big{
      font-weight:900;
      font-size: 22px;
      letter-spacing:-.3px;
    }
    .kpis{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .kpi{
      border:1px solid var(--line);
      background: rgba(10,12,16,.4);
      border-radius: 12px;
      padding: 10px 10px;
      min-width: 90px;
    }
    .kpi .v{font-size: 18px; font-weight: 900}
    .kpi .t{font-size: 12px; color: var(--muted); margin-top:2px}
    .hint{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.45;
    }
    .question{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }
    .qmeta{
      color: var(--muted);
      font-size: 12px;
    }
    .qword{
      font-size: 30px;
      font-weight: 1000;
      letter-spacing:-.6px;
      margin: 6px 0 2px;
      word-break:break-word;
    }
    .qsub{
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 12px;
    }
    .choices{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      margin-top: 10px;
    }
    @media (min-width: 640px){
      .choices{grid-template-columns: 1fr 1fr;}
    }
    .choice{
      border:1px solid var(--line);
      background: rgba(10,12,16,.4);
      border-radius: 14px;
      padding: 12px 12px;
      cursor:pointer;
      transition: border-color .12s ease, transform .06s ease;
      user-select:none;
      min-height: 48px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .choice:hover{border-color: rgba(122,167,255,.45)}
    .choice:active{transform: translateY(1px)}
    .badge{
      width: 22px; height:22px; border-radius: 7px;
      border:1px solid var(--line);
      display:grid; place-items:center;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
      flex:0 0 auto;
      background: rgba(18,20,28,.6);
    }
    .choice.good{border-color: rgba(61,220,151,.6); box-shadow: 0 0 0 3px rgba(61,220,151,.12)}
    .choice.bad{border-color: rgba(255,107,107,.65); box-shadow: 0 0 0 3px rgba(255,107,107,.12)}
    .choice.lock{pointer-events:none; opacity:.95}
    .explain{
      margin-top: 12px;
      border:1px solid var(--line);
      background: rgba(10,12,16,.35);
      border-radius: 14px;
      padding: 12px;
      display:none;
    }
    .explain .hdr{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .tag{
      font-size: 12px;
      padding: 6px 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(18,20,28,.6);
      color: var(--muted);
      white-space:nowrap;
    }
    .explain .kr{
      font-size: 14px;
      margin: 2px 0 8px;
      font-weight: 800;
      letter-spacing:-.1px;
    }
    .explain .rule{
      color: var(--muted);
      font-size: 12px;
      line-height: 1.55;
      margin: 0 0 10px;
    }
    .imgbox{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:flex-start;
    }
    .imgbox img{
      width: 320px;
      max-width: 100%;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(18,20,28,.5);
    }
    .smallnote{font-size: 12px; color: var(--muted); margin-top:6px}
    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">단어 시험</div>
      <div class="pill">
        ⏱️ <span id="timer">00:00</span>
        <span style="opacity:.5">|</span>
        <span id="rangeInfo">범위: -</span>
      </div>
    </div>

    <div class="grid">
      <div class="card" id="setupCard">
        <h2>설정</h2>

        <label>문제 수</label>
        <select id="countSel">
          <option value="10">10문제</option>
          <option value="20">20문제</option>
          <option value="30">30문제</option>
          <option value="40">40문제</option>
          <option value="50" selected>50문제</option>
        </select>

        <div class="row">
          <div>
            <label>시작 번호</label>
            <input id="startNum" type="number" value="1701" min="1" />
          </div>
          <div>
            <label>끝 번호</label>
            <input id="endNum" type="number" value="3000" min="1" />
          </div>
        </div>

        <div class="sep"></div>

        <div class="btns">
          <button id="startBtn" type="button">시험 시작</button>
          <button id="resetBtn" type="button" class="secondary">초기화</button>
        </div>

        <p class="hint" style="margin-top:12px">
          - 정답이면 <b>바로 다음 문제</b>로 이동<br/>
          - 오답이면 <b>간단 원리 설명</b> + <b>단어 이미지화(연상 그림)</b> 표시 후 다음으로 이동
        </p>
      </div>

      <div class="card" id="quizCard">
        <h2>진행</h2>

        <div class="scoreline">
          <div>
            <div class="qmeta" id="progress">0 / 0</div>
            <div class="big" id="score">0점</div>
          </div>
          <div class="kpis">
            <div class="kpi">
              <div class="v" id="kpiAttempt">0</div>
              <div class="t">총 응시</div>
            </div>
            <div class="kpi">
              <div class="v" id="kpiCorrect">0</div>
              <div class="t">정답</div>
            </div>
            <div class="kpi">
              <div class="v" id="kpiWrong">0</div>
              <div class="t">오답</div>
            </div>
          </div>
        </div>

        <div class="sep"></div>

        <div id="qArea">
          <div class="question">
            <div>
              <div class="qword" id="qWord">-</div>
              <div class="qsub" id="qSub">뜻(국문)을 고르세요</div>
            </div>
            <div class="qmeta" id="qNo">#-</div>
          </div>

          <div class="choices" id="choices"></div>

          <div class="explain" id="explainBox">
            <div class="hdr">
              <div class="tag" id="resultTag">오답</div>
              <button id="nextBtn" type="button" style="max-width:180px">다음</button>
            </div>
            <div class="kr" id="exKr">-</div>
            <p class="rule" id="exRule">-</p>

            <div class="imgbox">
              <img id="mnImg" alt="연상 그림" />
              <div style="flex:1; min-width: 220px;">
                <div class="tag">이미지화 포인트</div>
                <div class="smallnote" id="mnNote">-</div>
              </div>
            </div>
          </div>
        </div>

        <div id="doneArea" class="hidden">
          <div class="qword" style="font-size:26px;margin-top:2px;">시험 종료</div>
          <div class="qsub">팝업으로 점수가 표시되었습니다.</div>
          <div class="btns" style="margin-top:12px;">
            <button id="restartBtn" type="button">다시 시작</button>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
/* =========================
   1) 단어 데이터 (1451~3000)
   - 네가 올린 목록을 그대로 넣었고,
   - 파서는 "번호 / 영문 / 국문" 형식만 뽑아서 사용함
   - 중복 번호는 '처음 나온 것'을 사용
========================= */
const RAW_WORDS = `
1451 / impartial / 공정한, 편견이 없는
1452 / confederate / 공범, 공모자
1453 / legislation / 법률(제정)
1454 / inscription / 새기기, 명각
1455 / versatile / 다재다능한, 다용도의
1456 / limp / 기운이 없는, 축 처진
1457 / intrinsic / 고유한, 본질적인
1458 / limb / 팔, 다리, (새의) 날개
1459 / prehistoric / 선사 시대의
1460 / rush / 서두르다
1461 / stale / 진부한, 신선하지 않은
1462 / gratitude / 감사, 고마움
1463 / garment / 의복, 옷
1464 / reproach / 비난하다, 나무라다
1465 / handicap / 불리하게 만들다, 방해하다
1466 / spiny / 가시가 많은
1467 / suspicion / 의심, 불신, 혐의
1468 / spawn / (알을) 낳다, 생산하다
1469 / sedentary / 한곳에 머물러 사는, 정착하고 있는
1470 / humble / 겸손한
1471 / incur / (나쁜 상황을) 초래하다, (손해·빚을) 발생시키다
1472 / indulge / (욕구·쾌락에) 빠지다, 탐닉하다
1473 / thaw / 녹다, 해동시키다
1474 / inspection / 사찰, 점검, 정밀조사
1475 / invert / 뒤집다, 도치시키다
1476 / leftover / (주로 복수로) 남은 음식
1477 / liken / ~에 비유하다
1478 / disseminate / (정보·사상 등을) 퍼뜨리다, 전파하다
1479 / linger / 남아 있다, 오래 끌다
1480 / circumstance / 상황, 환경
1481 / martial / 싸움의, 전쟁의
1482 / sorrowful / 슬픈
1483 / peninsula / 반도
1484 / monk / 수도자, 수도승
1485 / maternal / 어머니의, 모성의
1486 / minister / 성직자, 목사
1487 / monetary / 통화[화폐]의, 금전의
1488 / nostalgia / 향수(병)
1489 / oblige / 의무적으로 ~하게 하다, 강요하다
1490 / vocational / 직업과 관련된, 직무상의
1491 / contestant / (대회·시합의) 참가자
1492 / subside / 가라앉다, 진정되다
1493 / stiffen / 뻣뻣해지다, 경직되다
1494 / onward / 앞으로, 나아가서
1495 / outlaw / 불법화하다, 금하다
1496 / outset / 착수, 시초, 발단
1497 / overturn / 뒤집(히)다
1498 / ramification / 파문, 영향
1499 / pathway / 좁은 길, 통로
1500 / pierce / 뚫다, 관통하다
1501 / nutrient / 영양소, 영양분
1502 / lodge / 오두막, 산장
1503 / loom / 어렴풋이 나타나다, 곧 닥칠 것처럼 보이다
1504 / mainstream / (사상 등의) 주류, 대세
1505 / manuscript / (책·악보 등의) 원고, 사본
1506 / erupt / (화산이) 분출하다, 폭발하다
1507 / mighty / 강력한, 힘센
1508 / hull / 선체
1509 / muddy / 진흙투성이인
1510 / nuisance / 성가신 사람[일], 골칫거리
1511 / splendid / 훌륭한, 멋진
1512 / strife / 갈등, 불화, 다툼
1513 / stature / 위상, 수준
1514 / adversity / 역경, 고난
1515 / spacious / 넓은
1516 / unconsciously / 무의식적으로
1517 / authoritative / 권위 있는
1518 / actualize / 현실로 만들다, 실현하다
1519 / console / 위로하다
1520 / drag / 끌다, 끌고 가다
1521 / authentic / 진정한, 진짜의
1522 / mammal / 포유동물
1523 / plunge / 돌입하다
1524 / gigantic / 거대한
1525 / predominate / 우세하다, 지배하다
1526 / rust / 녹이 슬다, 부식하다[시키다]
1527 / recede / 물러나다, 약해지다
1528 / reprimand / 질책하다
1529 / rhetorical / 수사적인, 웅변적인
1530 / riddle / 구멍을 숭숭 뚫다, 벌집같이 만들다
1531 / generalization / 일반화
1532 / scramble / 기어 오르다
1533 / speculate / 추측[짐작]하다
1534 / stalk / (식물의) 줄기
1535 / stroll / 산책하다, 거닐다
1536 / stumble / 우연히 발견하다
1537 / outrun / 더 빨리[멀리] 달리다
1538 / squeeze / 짜다
1539 / dumb / 멍청한
1540 / stifle / 억누르다, 억압하다
1541 / inescapable / 피할 수 없는
1542 / supervision / 감독, 관리, 지휘
1543 / synthetic / 합성한, 인조의
1544 / peer / 응시하다, 유심히 보다
1545 / reconstruct / 재구성[재현]하다
1546 / enroll / 등록하다
1547 / utilize / 활용[이용]하다
1548 / dignity / 위엄, 품위, 존엄(성)
1549 / slay / 죽이다
1550 / presuppose / 상정하다, 전제로 하다
1551 / examine / 검사[조사]하다
1552 / saturate / 포화시키다, 포화 상태를 만들다
1553 / generate / 발생시키다, 초래하다
1554 / sprout / 싹이 나다
1555 / offend / 기분을 상하게 하다
1556 / infancy / 유아기
1557 / stink / 악취를 풍기다, 냄새가 나다
1558 / withdraw / 취소[철회]하다
1559 / paddle / 노를 젓다, 첨벙거리다
1560 / propose / (계획·생각을) 제안[제시]하다
1561 / submerge / 물속에 넣다[잠기다]
1562 / overtake / 추월하다, 능가하다
1563 / expose / 드러내다, 노출시키다
1564 / tariff / 관세
1565 / utterly / 완전히, 순전히, 전혀
1566 / underestimate / 너무 적게 잡다, 과소평가하다
1567 / undue / 지나친, 과도한
1568 / carve / 조각하다, 새기다
1569 / descendant / 자손, 후예
1570 / vein / 정맥, 혈관
1571 / informative / 유익한, 교육적인
1572 / predator / 포식자
1573 / withhold / (~을) 주지 않다, 보류하다
1574 / install / 설치하다, 장착하다
1575 / absurd / 불합리한
1576 / archaeology / 고고학
1577 / apparatus / (신체의) 기관
1578 / acclaim / 환호, 갈채
1579 / herald / 알리다, 발표하다
1580 / succumb / 굴복하다, (병 등으로) 쓰러지다
1581 / stack / 쌓다, 쌓이다
1582 / hostage / 인질
1583 / thrift / 절약, 검약
1584 / anonymous / 익명인, 신원 불명의
1585 / landfill / 쓰레기 매립(지)
1586 / astound / 경악시키다, 큰 충격을 주다
1587 / uphold / (법·원칙 등을) 유지하다, 옹호하다
1588 / terrain / 지형, 지역
1589 / thermal / 열의, 뜨거운
1590 / thrust / (거칠게) 밀치다, 찌르다
1591 / vegetation / 초목, 식물
1592 / passionate / 열정적인, 열렬한
1593 / anthropology / 인류학
1594 / aboriginal / (특히 오스트레일리아의) 원주민의
1595 / abide / (규칙을) 지키다
1596 / sediment / 침전[퇴적]물, 앙금
1597 / magnify / 확대하다, 증대하다
1598 / respondent / 응답자
1599 / alleviate / 완화하다, 경감시키다
1600 / alienate / 멀리하다, 소원하게 하다
1601 / aristocrat / 귀족, 상류 계급의 사람
1602 / savage / 무참히 공격하다
1603 / summon / 소환하다, 소집하다, 호출하다
1604 / empathy / 공감, 감정이입
1605 / unearth / 밝혀내다, 찾다
1606 / assert / 주장하다, 단언하다
1607 / forecast / 예측하다, 예보하다
1608 / bankrupt / 파산한
1609 / banquet / 연회
1610 / scant / 부족한, 거의 없는
1611 / bitterness / 신랄함, 쓰라림, 비통
1612 / fuse / 융합시키다
1613 / adapt / 맞추다, 적응하다
1614 / willful / 계획적인, 고의의
1615 / bureaucracy / 관료 제도, 관료 정치
1616 / insurmountable / 극복할 수 없는
1617 / inanimate / 무생물의
1618 / layer / 층, 겹
1619 / comply / 응하다, 따르다
1620 / secular / 세속적인
1621 / confess / 자백하다, 고백하다, 인정하다
1622 / confide / (비밀을) 털어놓다
1623 / considerate / 사려 깊은, 배려하는
1624 / discrepancy / 차이, 불일치
1625 / daze / 멍하게 하다, 어리둥절하게 하다
1626 / decency / 품위, 체면
1627 / enclose / 동봉하다
1628 / swap / 바꾸다, 교환하다
1629 / cluster / 무리, 송이
1630 / dart / 쏜살같이 움직이다
1631 / empathic / 감정 이입의, 공감할 수 있는
1632 / consolidate / 통합하다, 합병하다
1633 / emerge / 나오다, 드러나다
1634 / breakdown / 붕괴, 몰락, 쇠약
1635 / brutal / 잔혹한, 무자비한, 거친
1636 / buoyancy / 부력
1637 / catalyst / 촉매제, 자극
1638 / inquire / 묻다, 알아보다
1639 / clap / 박수를 치다
1640 / conspire / 협력하다, 함께 작용하다
1641 / invigorate / 기운 나게 하다, 활기를 띠게 하다
1642 / capture / 포착하다
1643 / pseudo / 허위의, 가짜의
1644 / confrontation / 직면, 대립
1645 / contemplate / 생각하다, 고려하다
1646 / ritual / (종교) 의식
1647 / discipline / 훈육하다, 단련하다
1648 / delicate / 미묘한, 미세한
1649 / contend / 주장하다, 논쟁하다
1650 / blunt / 둔화시키다, 무디게 하다
1651 / edible / 먹을 수 있는

1695 / syllable / 음절, 한마디
1696 / symmetry / 대칭, 균형
1697 / swear / 맹세하다, 단언하다
1698 / improvise / 즉흥적으로 하다, 임시변통으로 만들다
1699 / humiliate / 굴욕감을 주다
1700 / illuminate / 비추다, 밝게 하다
1701 / hub / 중심지, 중추
1702 / indefinitely / 무기한으로, 무한히
1703 / nasty / 비열한, 심술궂은
1704 / inject / (다른 것을) 도입하다, 넣다
1705 / inventory / 재고(품)
1706 / breed / 새끼를 낳다
1707 / specify / 명시하다
1708 / legitimate / 합법적인, 정당한
1709 / democracy / 민주주의
1710 / magnetic / 자성의, 자석 같은
1711 / lurk / 숨다, 잠복하다
1712 / infrared / 적외선의
1713 / midst / 중앙, 한가운데
1714 / avail / 이익, 효용, 효력
1715 / receptive / (제안·생각 등을) 잘 받아들이는, 수용적인
1716 / ascend / 오르다, 올라가다
1717 / handy / 편리한, 유용한, 다루기 쉬운
1718 / parasitic / 기생하는
1719 / originality / 독창성
1720 / implicit / 암시된, 내포된
1721 / malady / 질병
1722 / inflame / 흥분시키다, 격분시키다, 부추기다
1723 / inhale / 숨을 들이쉬다, 흡입하다
1724 / distribute / 나누어 주다, 분배하다
1725 / keen / 간절히 ~하고 싶은, 열망하는
1726 / lean / 기울다, 기울이다
1727 / leather / 가죽
1728 / mediocre / 보통의, 평범한
1729 / rapport / (친밀한) 관계, 유대
1730 / integrate / 통합하다, 통합되다
1731 / timid / 소심한, 겁 많은
1732 / meticulous / 꼼꼼한, 세심한
1733 / pervade / 만연하다, 스며들다
1734 / mold / 틀
1735 / deformity / 기형
1736 / nibble / 조금씩 먹다
1737 / bulk / 부피가 커지다, 덩어리가 되다
1738 / complicit / 연루된, 공모한
1739 / prerequisite / 전제 조건
1740 / haul / 세게 끌다, 질질 끌고 가다
1741 / maneuver / 교묘하게 다루다, 조종하다
1742 / outcompete / 경쟁에서 이기다
1743 / toss / 던지다
1744 / outrage / 격분, 격노
1745 / pavement / 포장도로, 노면, 인도
1746 / pension / 연금, 생활 보조금
1747 / prohibit / 금하다, 금지하다
1748 / fascinate / 매혹하다, 반하게 하다
1749 / loosen / 느슨하게 하다
1750 / oval / 타원형
1751 / plagiarism / 표절, 도용
1752 / porch / 현관, 베란다
1753 / posture / 자세, 태도
1754 / pragmatic / 실용적인
1755 / morale / 사기, 의욕
1756 / mutter / 중얼거리다, 불평하다
1757 / pedestrian / 보행자
1758 / tersely / 간결하게
1759 / torment / 괴롭히다, 고통을 주다
1760 / torture / 고문하다, 괴롭히다
1761 / tread / 밟기, 걸음걸이
1762 / overhear / 우연히 듣다, 엿듣다
1763 / petty / 사소한, 하찮은
1764 / suppress / 억압하다, 진압하다
1765 / arrange / 정렬하다, 배열하다
1766 / paw / (동물의) 발
1767 / peripheral / 주변적인, 지엽적인
1768 / weird / 기이한, 기묘한, 이상한
1769 / quota / 할당량
1770 / petition / 탄원하다, 청원하다
1771 / pitfall / 위험, 함정
1772 / trail / 자국, 흔적
1773 / asthma / 천식
1774 / sag / 축 처지다
1775 / horizon / 수평선, 지평선
1776 / prescribe / 처방하다

2694 / codify / 법전으로 편찬하다, 체계적으로 정리하다
2695 / nest / 둥지를 틀다; 둥지, 집
2696 / diverse / 다양한
2697 / dig / (땅을) 파다, 발굴하다
2698 / minute / 미세한; (시간 단위의) 분
2699 / essay / 수필, 에세이
2700 / arousal / 각성, 환기
2701 / break in / 침입하다
2702 / fill in / 메우다; (서류에) 기입하다
2703 / get in / 안으로 들어가다; (차에) 타다
2704 / stay in / 집에 있다, 외출하지 않다
2705 / break in / (대화·활동을) 방해하다
2706 / engage in / ~에 관여하다, 참여하다
2707 / listen in / 엿듣다, 도청하다
2708 / step in / (사건·논쟁에) 개입하다
2709 / hand in / 제출하다
2710 / put in / (요구·의견 등을) 제출하다, 제기하다
2711 / turn in / 제출하다
2712 / get in / 도착하다
2713 / believe in / ~의 존재를 믿다
2714 / give in / 굴복하다, 양보하다
2715 / break into / 침입하다; 말참견하다
2716 / burst into / 갑자기 ~하다
2717 / go into / (일·직업 등을) 시작하다
2718 / run into / 우연히 만나다; 충돌하다
2719 / drop in / 잠깐 들르다
2720 / look in / 잠깐 들르다
2721 / put in for / ~에 응모하다, 신청하다
2722 / come in / 응모하다; 들어오다
2723 / set in / 도착하다; (유행·추위 등이) 시작되다
2724 / deal in / 매매하다, 장사하다
2725 / be into / ~에 관심이 있다, 좋아하다
2726 / come in / 입장하다; 수입으로 들어오다
2727 / fit in / 잘 어울리다; 시간을 내다
2728 / lie in / ~에 달려 있다; 늦잠을 자다
2729 / take in / 숙박시키다; 섭취하다; 이해하다
2730 / cut in / 끼어들다, 말을 자르다
2731 / join in / 합류하다, 동참하다
2732 / put in / 말참견하다
2733 / come about / (일이) 일어나다, 생기다
2734 / hear about / ~에 관해 알게 되다
2735 / go after / 얻으려 하다, 뒤쫓다
2736 / name after / ~의 이름을 따서 짓다
2737 / ask after / ~의 안부를 묻다
2738 / look after / 돌보다, 보살피다
2739 / come across / 우연히 만나다; 이해되다
2740 / get across / 전달되다; 이해시키다
2741 / spread across / ~에 걸쳐 퍼지다
2742 / come along / 나타나다; 진척되다; 회복되다
2743 / go along / 동행하다; 찬성하다; 진전되다
2744 / sleep through / 깨지 않고 계속 자다
2745 / get by / 지나가다, 통과하다
2746 / pass by / 지나가다
2747 / call by / 잠깐 들르다
2748 / drop by / 잠깐 들르다
2749 / be ahead / 앞서 있다, 이기고 있다
2750 / get ahead of / ~을 앞지르다
2751 / go ahead with / 진행하다, 추진하다
2752 / fall back / 뒤처지다, 후퇴하다
2753 / look back / 회상하다
2754 / cut back / 줄이다, 삭감하다
2755 / bring back / 돌려주다; 상기시키다
2756 / come back / 돌아오다; (기억·유행 등이) 다시 떠오르다
2757 / give back / 돌려주다
2758 / pay back / (돈을) 갚다; 복수하다
2759 / tell from / ~와 구별하다
2760 / attend to / ~에 주의를 기울이다; 돌보다
2761 / come to / 정신이 들다; (생각이) 떠오르다
2762 / get to / ~에 도착하다; ~을 시작하다
2763 / look to / ~에 의지하다; 기대하다
2764 / refer to / 언급하다; 가리키다
2765 / turn to / ~에 의지하다; (성질·상태가) 변하다
2766 / adhere to / ~에 들러붙다; 고수하다
2767 / keep to / (규칙·계획 등을) 따르다
2768 / amount to / 총액이 ~에 달하다
2769 / hang around / 어슬렁거리다; 시간을 보내다
2770 / show around / 구경시키다, 안내하다
2771 / bring around / 정신 차리게 하다; 설득하다
2772 / turn around / 방향을 바꾸다; 호전시키다
2773 / break through / (장벽·난관 등을) 극복하다
2774 / come through / 통과하다; 성공하다
2775 / go through / (어려움·과정 등을) 겪다
2776 / look through / 훑어보다; 재빨리 읽다
2777 / put through / ~을 겪게 하다
2778 / appeal to / ~에게 간청하다; 마음에 들다
2779 / belong to / ~에 속하다
2780 / contribute to / ~에 기여하다
2781 / lead to / (어떤 결과에) 이르다
2782 / occur to / (생각이) 떠오르다
2783 / see to / ~을 돌보다; 처리하다
2784 / yield to / ~에 굴복하다
2785 / hold to / 고집하다, 고수하다
2786 / stick to / ~을 고수하다; 따르다
2787 / come to / 합계가 ~이 되다
2788 / prefer to / ~을 더 좋아하다
2789 / relate to / ~와 관련되다
2790 / look forward to / ~을 기대하다
2791 / come up to / (수준·기대 등에) 달하다
2792 / make up for / (손해 등을) 보상하다
2793 / keep up / (수준·상태 등을) 유지하다
2794 / take up / 시작하다; (공간·시간을) 차지하다
2795 / be up to / ~을 감당하다; ~의 책임이다
2796 / come up against / (문제·반대 등에) 직면하다
2797 / face up to / 용감하게 맞서다
2798 / keep up with / 뒤처지지 않고 따라가다
2799 / figure out / 이해하다; 알아내다
2800 / make out / (애써) 이해하다
2801 / stand out / 두드러지다; 눈에 띄다
2802 / work out / (일이) 잘 되다; 결국 ~하게 되다
2803 / speak out / 분명하게 말하다
2804 / clean out / 말끔히 청소하다; 완전히 치우다
2805 / dry out / 완전히 마르다
2806 / fill out / (서류에) 필요 사항을 작성하다
2807 / make out / (증서·수표 등을) 작성하다
2808 / plan out / 면밀히 계획하다
2809 / spell out / 철자를 하나하나 읽다[쓰다]; 상세히 설명하다
2810 / try out / 시험해 보다
2811 / hand out / 나누어 주다
2812 / reach out / (손 등을) 내밀다; 도움을 요청하다
2813 / find out / 알아내다; 발견하다
2814 / point out / 가리키다; 지적하다
2815 / turn out / 판명되다; 결국 ~임이 드러나다
2816 / call out / 큰 소리로 외치다
2817 / read out / 큰 소리로 읽다
2818 / set up / 시작하다; 창설하다
2819 / count out / 제외하다
2820 / fade out / 점점 희미해지다; 서서히 사라지다
2821 / help out / 돕다
2822 / leave out / 빠뜨리다; 생략하다
2823 / put out / (불·빛 등을) 끄다
2824 / run out / 다 써버리다; 바닥나다
2825 / wear out / 닳게 하다; 지치게 하다
2826 / back up / 후원하다; 지지하다
2827 / dig up / 파내다; (정보를) 찾아내다
2828 / hang up / (옷을) 걸다; 전화를 끊다
2829 / lift up / 들어 올리다
2830 / pick up / 줍다; (차로) 태우다
2831 / prop up / (버팀목으로) 받치다; 지탱하다
2832 / sit up / 일어나 앉다
2833 / stay up / 자지 않고 깨어 있다
2834 / bring up / 키우다; (화제를) 꺼내다
2835 / grow up / 자라다; 어른이 되다
2836 / speak up / 큰 소리로 말하다
2837 / step up / 증가시키다; 강화하다
2838 / stand up for / ~을 옹호하다; 지지하다
2839 / throw up / 토하다
2840 / go up / (가격·온도 등이) 오르다
2841 / put up / (집·천막 등을) 세우다
2842 / speed up / 속도를 높이다
2843 / turn up / (소리·불 등을) 키우다
2844 / drop out / 낙오하다; 중퇴하다
2845 / go out / (불·빛 등이) 꺼지다; 쇠퇴하다
2846 / knock out / (남을) 때려눕히다
2847 / pass out / 의식을 잃다; 기절하다
2848 / rule out / 배제하다; 제외하다
2849 / wash out / 씻어내다; (계획 등이) 실패하다
2850 / wipe out / 쓸어버리다; 파괴하다
2851 / build up / 쌓다; 축적하다; (신뢰·자신감 등을) 키우다
2852 / get up / 일어나다
2853 / hold up / 떠받치다; 지연시키다
2854 / look up to / 존경하다
2855 / pile up / 쌓이다; 쌓아 올리다
2856 / burn out / 타버리다; (과로로) 지치게 하다
2857 / cut out / 제거하다; 그만두다
2858 / fight out / (해결될 때까지) 싸우다
2859 / hear out / (~의 말을) 끝까지 듣다
2860 / map out / 계획을 세밀하게 세우다
2861 / sell out / 다 팔리다; 다 팔아버리다
2862 / tire out / 녹초가 되게 하다
2863 / give out / (빛·소리·냄새 등을) 발하다
2864 / lay out / 펼치다; 진열하다; 설계하다
2865 / spread out / 펼치다; (범위가) 퍼지다
2866 / turn into / ~이 되다; ~으로 변하다
2867 / bring out / 끌어내다; (능력 등을) 발휘하게 하다
2868 / check out / (호텔 등에서) 계산하고 나오다
2869 / get out of / ~에서 나가다; 떠나다
2870 / keep out / 들어오지 못하게 하다
2871 / see out / (현관까지) 배웅하다
2872 / slip out / 무심코 말해지다
2873 / stick out / 불쑥 나오다; 눈에 띄다
2874 / break out / (화재·전쟁 등이) 발생하다
2875 / check out / 검사하다; 점검하다
2876 / bump into / 우연히 만나다; ~에 부딪치다
2877 / get into / ~에 들어가다; 입학 허가를 받다; (옷·신발을) 입다
2878 / look into / 조사하다; 연구하다
2879 / talk into / 설득하여 ~하게 하다
2880 / ask out / 데이트 신청하다
2881 / burst out / 갑자기 ~하다; 터뜨리다
2882 / eat out / 외식하다
2883 / grow out of / ~에서 벗어나다; ~에서 생기다
2884 / leak out / (정보가) 새다; 누설되다
2885 / set out / 출발하다; 착수하다
2886 / sort out / 정리하다; 가려내다
2887 / take out / 꺼내다; 외출을 시켜주다
2888 / carry out / 실행하다; 이행하다
2889 / come out / 출판되다; 출시되다; 알려지다
2890 / cheer up / 격려하다; 기운 나게 하다
2891 / start up / (사업·기계 등을) 시작하다
2892 / warm up / 준비 운동을 하다
2893 / catch up / 따라잡다
2894 / feel up to / ~을 할 기분(컨디션)이 들다
2895 / live up to / (기대·기준 등에) 부응하다
2896 / hold up / 지속하다; 견디다
2897 / put up with / 참고 견디다
2898 / let up / (비·눈 등이) 멎다
2899 / blow up / 폭발하다; 폭파하다
2900 / clean up / 청소하다; (부패·오염 등을) 정화하다
2901 / cover up / 감추다; 은폐하다
2902 / eat up / 소비하다; 써버리다
2903 / draw up / (차 등이) 서다
2904 / pull up / (차가) 멈추다
2905 / check up on / 확인하다; 점검하다
2906 / close up / 닫다; 폐쇄하다
2907 / dress up / 잘 차려입다
2908 / end up / 결국 ~이 되다
2909 / follow up / 후속 조치하다; 더 철저히 알아보다
2910 / hold up / 지연시키다
2911 / look up / (사전·자료 등에서) 찾아보다
2912 / shut up / 잠그다; 닫다
2913 / use up / (연료·힘·돈 등을) 다 써버리다
2914 / bring up / (문제 등을) 꺼내다; 거론하다
2915 / draw up / (문서·계획 등을) 작성하다
2916 / line up / 한 줄로 서다; 줄을 세우다
2917 / pick up / 포착하다; (우연히) 얻다; 입수하다
2918 / think up / 생각해 내다; 고안하다
2919 / fill up / 채우다; 가득 차다
2920 / give up / 그만두다; 포기하다
2921 / lock up / 자물쇠를 채우다; 잠그다
2922 / pay up / 전액을 납입하다; 다 갚다
2923 / straighten up / 정리하다; 똑바로 하다
2924 / wrap up / 싸다; (외투 등을) 입다; (회의·일을) 마치다
2925 / come up with / 생각해 내다; 창안하다
2926 / fix up / 마련해 주다; 수리하다; 정리해 주다
2927 / make up / 구성하다; 지어내다; 날조하다
2928 / show up / (모임 등에) 나타나다
2929 / turn up / 도착하다; 나타나다
2930 / sum up / 요약하다
2931 / chop up / (칼 등으로) 잘게 썰다
2932 / tear up / (갈기갈기) 찢다
2933 / come down / (비·눈 등이) 내리다
2934 / fall down / 넘어지다; 굴러떨어지다
2935 / gulp down / (음료·음식 등을) 급하게 삼키다
2936 / kneel down / 꿇어앉다
2937 / pass down / 물려주다; (후대로) 전해주다
2938 / add up / 합계하다
2939 / break up / 산산조각으로 부서지다; (군중 등을) 해산시키다
2940 / crush up / 눌러 으깨다
2941 / bring down / (짐 등을) 내리다
2942 / cut down / (나무 등을) 베어 넘어뜨리다
2943 / go down / (해·달이) 지다; (배·비행기가) 침몰하다·추락하다
2944 / hand down / (후대에) 전수하다, 물려주다
2945 / knock down / 치어 쓰러뜨리다; (건물 등을) 헐다
2946 / put down / 내려놓다
2947 / run down / (자동차가 사람을) 치다
2948 / step down / 사직하다; 은퇴하다
2949 / bring down / 낮추다; 끌어내리다
2950 / boil down to / 결국 ~이다; 요약되다
2951 / come down / 감소하다
2952 / count down / (수를) 큰 것부터 거꾸로 세다
2953 / die down / 점점 조용해지다; 그치다
2954 / settle down / 진정하다; (흥분 등이) 가라앉다
2955 / turn down / (소리·열·불 등을) 줄이다
2956 / hold down / (가격·비용 등을) 억제하다; 상승을 막다
2957 / put down / (폭동·반란 등을) 진압하다
2958 / close down / 폐쇄하다; 문을 닫다
2959 / get down to / (일·공부 등을) 착수하다
2960 / settle down / 자리 잡다; 정착하다
2961 / tie down / 속박하다; 얽매다
2962 / weigh down / (무게로) 내리누르다; 압박하다
2963 / put down / 창피를 주며 비난하다
2964 / sit down / 앉다
2965 / take down / (아래로) 내리다; 기록하다
2966 / boil down / 졸이다; 요약하다
2967 / calm down / 가라앉다; 진정하다
2968 / come down with / (질병에) 걸리다
2969 / call on / ~에게 요청하다; 방문하다
2970 / dwell on / ~에 대해 곰곰이 생각하다
2971 / insist on / ~을 주장하다; 고집하다
2972 / decide on / ~으로 결정하다
2973 / hit on / 생각해 내다; 우연히 발견하다
2974 / let on / (비밀 등을) 누설하다
2975 / reflect on / ~을 반성하다; 되돌아보다
2976 / work on / ~에 영향을 주다; 작용하다
2977 / pick on / 비난하다; 못살게 굴다
2978 / tell on / ~에 대해 고자질하다
2979 / act on / (주의·명령 등에 따라) 행동하다
2980 / count on / ~에 의지하다; 기대하다
2981 / feed on / ~을 먹고 살다
2982 / rely on / ~에 의존하다; 의지하다
2983 / brush off / 털어버리다; 거부하다
2984 / cut off / 베어내다; 잘라내다
2985 / get off / (버스·지하철 등에서) 내리다
2986 / shake off / (병·근심 등을) 없애 버리다
2987 / turn off / 잠그다; 끄다
2988 / lay off / 일시 해고하다
2989 / show off / 과시하다; 허세 부리다
2990 / pass over / 넘어가다; 간과하다
2991 / bring over / 데리고 오다; 가지고 오다
2992 / get over / (병에서) 회복되다; (어려움 등을) 극복하다
2993 / run over / (차가 사람을) 치다; (액체·감정 등이) 넘치다
2994 / bail out / ~를 구출하다; (위기에서) 벗어나다; 긴급 구제하다
2995 / cling to / ~을 고수하다; ~에 매달리다
2996 / be predisposed to / ~에 대한 성향을 갖다; ~하기 쉽다
2997 / go through with / ~을 실행하다; 끝까지 완수하다
2998 / turn over / (정보·권한 등을) 넘기다; 뒤집다
2999 / go over / 반복하다; 검토하다; 자세히 살펴보다
3000 / bottom line / 손익의 총결산; 핵심 결론
`;

/* =========================
   2) 유틸/파싱
========================= */
function parseWords(raw){
  const lines = raw.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
  const map = new Map(); // number -> {no,en,kr}
  for (const line of lines){
    // 허용 패턴: "1234 / english / korean"
    const m = line.match(/^(\d+)\s*\/\s*(.+?)\s*\/\s*(.+)$/);
    if(!m) continue;
    const no = Number(m[1]);
    const en = m[2].trim();
    const kr = m[3].trim();
    if(!map.has(no)) map.set(no, {no,en,kr});
  }
  return [...map.values()].sort((a,b)=>a.no-b.no);
}

function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function fmtTime(sec){
  const m = Math.floor(sec/60);
  const s = sec%60;
  return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
}

/* =========================
   3) 단어 이미지화(SVG 워드아트)
   - 외부 이미지 없이 "단어 자체"를 시각화
========================= */
function wordArtSVG(word, meaning){
  const w = 960, h = 600;
  const safeWord = (word||'').replace(/[<>&"]/g, s=>({ "<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;" }[s]));
  const safeMean = (meaning||'').replace(/[<>&"]/g, s=>({ "<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;" }[s]));

  // 분위기 키워드(아주 단순)
  const m = (meaning||'').toLowerCase();
  const mood =
    /분노|격분|비열|굴욕|고문|억압|탄압|위협|파괴|침입|불안|공포|나쁜|혐오/.test(meaning||'') ? 'dark' :
    /감사|기쁨|평화|안도|존경|보호|안정|따뜻|환호|훌륭/.test(meaning||'') ? 'bright' :
    'neutral';

  const grad = mood==='dark'
    ? `<linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
         <stop offset="0" stop-color="#3b1030"/>
         <stop offset="1" stop-color="#0f1633"/>
       </linearGradient>`
    : mood==='bright'
    ? `<linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
         <stop offset="0" stop-color="#163a4a"/>
         <stop offset="1" stop-color="#2a2f5a"/>
       </linearGradient>`
    : `<linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
         <stop offset="0" stop-color="#1a2140"/>
         <stop offset="1" stop-color="#25163a"/>
       </linearGradient>`;

  // 아이콘(단어 형태에 따라 대충 하나 선택)
  const iconType = (() => {
    const x = word.toLowerCase();
    if (x.includes('up') || x.includes('ascend') || x.includes('rise')) return 'arrow';
    if (x.includes('down') || x.includes('fall')) return 'down';
    if (x.includes('in') || x.includes('into') || x.includes('enter')) return 'in';
    if (x.includes('out')) return 'out';
    if (x.includes('turn')) return 'turn';
    if (x.includes('break')) return 'crack';
    if (x.includes('run') || x.includes('rush')) return 'speed';
    if (x.includes('look') || x.includes('see') || x.includes('peer')) return 'eye';
    return 'spark';
  })();

  const icon = (() => {
    switch(iconType){
      case 'arrow':
        return `<path d="M150 430 L300 280 L380 360 L380 240 L500 240 L500 360 L580 280 L730 430" fill="none" stroke="rgba(122,167,255,.85)" stroke-width="16" stroke-linecap="round" stroke-linejoin="round"/>`;
      case 'down':
        return `<path d="M150 260 L300 410 L380 330 L380 450 L500 450 L500 330 L580 410 L730 260" fill="none" stroke="rgba(255,107,107,.8)" stroke-width="16" stroke-linecap="round" stroke-linejoin="round"/>`;
      case 'in':
        return `<path d="M220 300 H600" stroke="rgba(122,167,255,.85)" stroke-width="18" stroke-linecap="round"/>
                <path d="M540 240 L620 300 L540 360" fill="none" stroke="rgba(122,167,255,.85)" stroke-width="18" stroke-linecap="round" stroke-linejoin="round"/>
                <rect x="140" y="220" width="140" height="160" rx="18" fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.14)"/>`;
      case 'out':
        return `<rect x="640" y="220" width="140" height="160" rx="18" fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.14)"/>
                <path d="M200 300 H560" stroke="rgba(61,220,151,.85)" stroke-width="18" stroke-linecap="round"/>
                <path d="M300 240 L180 300 L300 360" fill="none" stroke="rgba(61,220,151,.85)" stroke-width="18" stroke-linecap="round" stroke-linejoin="round"/>`;
      case 'turn':
        return `<path d="M260 360 C260 250 340 210 450 210 H640" fill="none" stroke="rgba(122,167,255,.85)" stroke-width="18" stroke-linecap="round"/>
                <path d="M600 170 L680 210 L600 250" fill="none" stroke="rgba(122,167,255,.85)" stroke-width="18" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="260" cy="360" r="12" fill="rgba(255,255,255,.45)"/>`;
      case 'crack':
        return `<rect x="220" y="210" width="520" height="180" rx="22" fill="rgba(255,255,255,.06)" stroke="rgba(255,107,107,.45)" stroke-width="2"/>
                <path d="M420 210 L470 260 L440 300 L500 350 L470 390" fill="none" stroke="rgba(255,107,107,.8)" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>`;
      case 'speed':
        return `<path d="M220 340 C260 260 360 230 460 230 C560 230 660 260 700 340" fill="none" stroke="rgba(61,220,151,.85)" stroke-width="18" stroke-linecap="round"/>
                <path d="M460 230 L530 310" stroke="rgba(61,220,151,.85)" stroke-width="12" stroke-linecap="round"/>
                <circle cx="460" cy="230" r="10" fill="rgba(255,255,255,.35)"/>`;
      case 'eye':
        return `<path d="M230 320 C310 240 410 210 480 210 C550 210 650 240 730 320 C650 400 550 430 480 430 C410 430 310 400 230 320Z"
                  fill="rgba(255,255,255,.06)" stroke="rgba(122,167,255,.65)" stroke-width="3"/>
                <circle cx="480" cy="320" r="56" fill="rgba(122,167,255,.18)" stroke="rgba(122,167,255,.6)" stroke-width="3"/>
                <circle cx="480" cy="320" r="22" fill="rgba(255,255,255,.65)"/>`;
      default:
        return `<path d="M480 200 L520 300 L630 310 L540 380 L570 490 L480 430 L390 490 L420 380 L330 310 L440 300 Z"
                  fill="rgba(122,167,255,.18)" stroke="rgba(122,167,255,.65)" stroke-width="3"/>`;
    }
  })();

  const svg = `
  <svg xmlns="http://www.w3.org/2000/svg" width="${w}" height="${h}" viewBox="0 0 ${w} ${h}">
    <defs>${grad}
      <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="10" stdDeviation="18" flood-color="rgba(0,0,0,.55)"/>
      </filter>
      <linearGradient id="txt" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="rgba(255,255,255,.98)"/>
        <stop offset="1" stop-color="rgba(200,210,255,.85)"/>
      </linearGradient>
    </defs>

    <rect x="0" y="0" width="${w}" height="${h}" fill="url(#g)"/>
    <circle cx="140" cy="120" r="110" fill="rgba(122,167,255,.10)"/>
    <circle cx="860" cy="90" r="140" fill="rgba(255,107,107,.08)"/>
    <circle cx="820" cy="520" r="170" fill="rgba(61,220,151,.08)"/>

    <g filter="url(#shadow)">
      <rect x="60" y="60" width="840" height="480" rx="28" fill="rgba(10,12,16,.35)" stroke="rgba(255,255,255,.14)"/>
      <g transform="translate(0,0)">
        ${icon}
      </g>

      <text x="480" y="185" text-anchor="middle"
            font-size="72" font-weight="900"
            font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial"
            fill="url(#txt)" letter-spacing="-1.2">${safeWord}</text>

      <text x="480" y="230" text-anchor="middle"
            font-size="20" font-weight="700"
            font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial"
            fill="rgba(231,233,238,.78)">${safeMean}</text>

      <rect x="180" y="260" width="600" height="1.5" fill="rgba(255,255,255,.14)"/>

      <text x="480" y="520" text-anchor="middle"
            font-size="14" font-weight="700"
            font-family="system-ui, -apple-system, Segoe UI, Roboto, Arial"
            fill="rgba(154,163,178,.85)">
        이미지화: 단어 글자(타이포) + 동작/방향 아이콘으로 의미를 붙여 기억하기
      </text>
    </g>
  </svg>`;
  return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
}

/* =========================
   4) 시험 로직
========================= */
const ALL_WORDS = parseWords(RAW_WORDS);

const $ = (id)=>document.getElementById(id);

const timerEl = $("timer");
const rangeInfoEl = $("rangeInfo");

const startBtn = $("startBtn");
const resetBtn = $("resetBtn");
const restartBtn = $("restartBtn");

const countSel = $("countSel");
const startNumEl = $("startNum");
const endNumEl = $("endNum");

const progressEl = $("progress");
const scoreEl = $("score");
const kpiAttempt = $("kpiAttempt");
const kpiCorrect = $("kpiCorrect");
const kpiWrong = $("kpiWrong");

const qWordEl = $("qWord");
const qNoEl = $("qNo");
const choicesEl = $("choices");

const explainBox = $("explainBox");
const resultTag = $("resultTag");
const exKr = $("exKr");
const exRule = $("exRule");
const mnImg = $("mnImg");
const mnNote = $("mnNote");
const nextBtn = $("nextBtn");

const qArea = $("qArea");
const doneArea = $("doneArea");

let quiz = {
  active:false,
  pool:[],
  questions:[],
  idx:0,
  attempt:0,
  correct:0,
  wrong:0,
  timerSec:0,
  timerId:null,
  locked:false
};

function stopTimer(){
  if(quiz.timerId){
    clearInterval(quiz.timerId);
    quiz.timerId = null;
  }
}
function startTimer(){
  stopTimer();
  quiz.timerId = setInterval(()=>{
    quiz.timerSec++;
    timerEl.textContent = fmtTime(quiz.timerSec);
  }, 1000);
}

function calcScore(){
  const total = quiz.questions.length || 0;
  if(total===0) return 0;
  // 100점 만점: 정답률
  return Math.round((quiz.correct / total) * 100);
}

function updateScoreUI(){
  progressEl.textContent = `${Math.min(quiz.idx+1, quiz.questions.length)} / ${quiz.questions.length}`;
  scoreEl.textContent = `${calcScore()}점`;
  kpiAttempt.textContent = String(quiz.attempt);
  kpiCorrect.textContent = String(quiz.correct);
  kpiWrong.textContent = String(quiz.wrong);
}

function buildPool(startNo, endNo){
  const lo = Math.min(startNo, endNo);
  const hi = Math.max(startNo, endNo);
  const pool = ALL_WORDS.filter(w => w.no >= lo && w.no <= hi);
  return pool;
}

function pickQuestions(pool, count){
  const shuffled = shuffle(pool);
  return shuffled.slice(0, Math.min(count, shuffled.length));
}

function makeChoices(correctKr, pool, n=4){
  const set = new Set([correctKr]);
  const others = shuffle(pool.map(x=>x.kr).filter(Boolean));

  for(const kr of others){
    if(set.size >= n) break;
    if(!set.has(kr)) set.add(kr);
  }
  // 부족하면(데이터 부족) 그냥 동일 pool에서 채움
  while(set.size < n){
    set.add(correctKr + " ");
  }
  return shuffle([...set]);
}

function showQuestion(){
  explainBox.style.display = "none";
  choicesEl.innerHTML = "";
  quiz.locked = false;

  const q = quiz.questions[quiz.idx];
  if(!q){
    finishQuiz();
    return;
  }
  qWordEl.textContent = q.en;
  qNoEl.textContent = `#${q.no}`;
  updateScoreUI();

  const choices = makeChoices(q.kr, quiz.pool, 4);
  const labels = ["A","B","C","D"];

  choices.forEach((kr, i)=>{
    const div = document.createElement("div");
    div.className = "choice";
    div.innerHTML = `<div class="badge">${labels[i]||""}</div><div style="font-weight:800; letter-spacing:-.1px;">${kr}</div>`;
    div.addEventListener("click", ()=>onChoose(div, kr, q));
    choicesEl.appendChild(div);
  });
}

function lockChoices(){
  [...choicesEl.querySelectorAll(".choice")].forEach(x=>x.classList.add("lock"));
}

function simpleRule(en, kr){
  // “원리”를 너무 길게 쓰지 않고, 기억법 중심으로 짧게
  const e = en.toLowerCase();
  if(e.includes("up")) return `포인트: "${en}"에는 'up(위로/강화)' 느낌이 들어가 있는 경우가 많아요. 뜻을 '상승/강화/유지' 방향으로 붙여 기억하세요.`;
  if(e.includes("down")) return `포인트: "${en}"은 'down(아래로/감소/진정)' 뉘앙스를 떠올리면 기억이 빨라요.`;
  if(en.includes(" ")) return `포인트: 구동사(두 단어 이상)는 핵심 전치사/부사(${en.split(" ").slice(-1)[0]})의 방향(들어감/나감/유지/전환)을 먼저 잡고 뜻을 붙이면 덜 헷갈립니다.`;
  if(e.endsWith("tion") || e.endsWith("sion")) return `포인트: -tion/-sion은 '명사(행위/상태/결과)'로 굳어지는 패턴이 많습니다. "${en}"을 '무엇의 상태/과정인가'로 묶어 기억하세요.`;
  if(e.endsWith("ive")) return `포인트: -ive는 '성질/경향(형용사)' 패턴이 자주 나옵니다. "${en}"을 '어떤 성격을 가진' 느낌으로 연결하세요.`;
  return `포인트: "${en}"을 소리(발음 리듬) + 이미지(상황)로 한 덩어리로 붙여서 기억하면 오래 갑니다.`;
}

function mnemonicNote(en, kr){
  const e = en.toLowerCase();
  if(e.includes("break")) return `단어에 "break"가 보이면 '부수다/깨다/침입하다/중단' 같은 '끊김' 이미지를 붙여봐.`;
  if(e.includes("turn")) return `"turn"은 '방향 전환/변화' 느낌이 강해. 머릿속에서 화살표가 꺾이는 그림으로 기억.`;
  if(e.includes("in")) return `"in"은 안으로 들어가는 장면, 문/상자 안으로 들어가는 장면으로 통째로 외워.`;
  if(e.includes("out")) return `"out"은 밖으로 나오는 장면(상자 밖으로 튀어나옴)으로 고정.`;
  return `뜻(국문)과 함께 "${en}" 글자 모양(타이포)을 한 장면처럼 떠올리면 기억이 오래 가.`;
}

function onChoose(choiceEl, selectedKr, q){
  if(quiz.locked) return;
  quiz.locked = true;
  lockChoices();
  quiz.attempt++;

  const isCorrect = (selectedKr.trim() === q.kr.trim());
  if(isCorrect){
    quiz.correct++;
    choiceEl.classList.add("good");

    updateScoreUI();

    // 정답이면 바로 다음 문제
    setTimeout(()=>{
      quiz.idx++;
      showQuestion();
    }, 220);
  }else{
    quiz.wrong++;
    choiceEl.classList.add("bad");

    // 정답도 표시
    [...choicesEl.querySelectorAll(".choice")].forEach(el=>{
      const txt = el.textContent.replace(/^[A-D]/,'').trim();
      if(txt === q.kr.trim()) el.classList.add("good");
    });

    updateScoreUI();

    // 오답 설명 + 단어 이미지화
    resultTag.textContent = "오답";
    resultTag.style.borderColor = "rgba(255,107,107,.55)";
    resultTag.style.color = "rgba(255,107,107,.9)";
    exKr.textContent = `정답: ${q.kr}`;
    exRule.textContent = simpleRule(q.en, q.kr);
    mnImg.src = wordArtSVG(q.en, q.kr);
    mnNote.textContent = mnemonicNote(q.en, q.kr);

    explainBox.style.display = "block";
  }
}

nextBtn.addEventListener("click", ()=>{
  if(!quiz.active) return;
  quiz.idx++;
  showQuestion();
});

function finishQuiz(){
  quiz.active = false;
  stopTimer();

  qArea.classList.add("hidden");
  doneArea.classList.remove("hidden");

  const score = calcScore();
  alert(`시험이 종료되었습니다.\n100점 만점에 ${score}점입니다.`);
}

function startQuiz(){
  // 버튼 클릭이 안 됐다는 이슈 방지: 여기서 예외를 막고 UI 업데이트를 즉시 함
  const count = Number(countSel.value);
  let s = Number(startNumEl.value);
  let e = Number(endNumEl.value);

  // 입력 이상치 방어
  if(!Number.isFinite(s)) s = 1701;
  if(!Number.isFinite(e)) e = 3000;

  // pool 구성
  const pool = buildPool(s, e);
  if(pool.length < 4){
    alert("해당 범위에 단어 데이터가 부족합니다. 시작/끝 번호를 조정해 주세요.");
    return;
  }

  // 범위 정보 표시
  const lo = Math.min(s,e), hi = Math.max(s,e);
  rangeInfoEl.textContent = `범위: ${lo}~${hi}`;

  quiz = {
    active:true,
    pool,
    questions: pickQuestions(pool, count),
    idx:0,
    attempt:0,
    correct:0,
    wrong:0,
    timerSec:0,
    timerId:null,
    locked:false
  };

  // UI 초기화
  timerEl.textContent = "00:00";
  qArea.classList.remove("hidden");
  doneArea.classList.add("hidden");

  updateScoreUI();
  startTimer();
  showQuestion();
}

function resetAll(){
  stopTimer();
  timerEl.textContent = "00:00";
  rangeInfoEl.textContent = "범위: -";

  qWordEl.textContent = "-";
  qNoEl.textContent = "#-";
  choicesEl.innerHTML = "";
  explainBox.style.display = "none";

  progressEl.textContent = "0 / 0";
  scoreEl.textContent = "0점";
  kpiAttempt.textContent = "0";
  kpiCorrect.textContent = "0";
  kpiWrong.textContent = "0";

  qArea.classList.remove("hidden");
  doneArea.classList.add("hidden");

  quiz.active = false;
}

startBtn.addEventListener("click", startQuiz);
resetBtn.addEventListener("click", resetAll);
restartBtn.addEventListener("click", ()=>{
  resetAll();
  startQuiz();
});

// 첫 로드: 데이터 존재 여부 간단 점검
(function init(){
  // 데이터가 완전 1451~3000 전체가 아니더라도, 있는 범위에서 동작하도록 했음
  // 기본값 1701~3000: 데이터가 부족하면 자동으로 사용자가 조정하면 됨
  // (네가 준 RAW 목록이 더 길면, 여기에 그대로 더 붙여넣으면 자동 반영됨)
})();
</script>
</body>
</html>
